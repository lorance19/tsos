// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

// Instead of prisma db push, for mongodb it is npx prisma generate

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                 String     @id @default(auto()) @map("_id") @db.ObjectId
  email              String     @unique
  phone              String?
  firstName          String?
  lastName           String?
  role               Role       @default(USER)
  profilePicturePath String?
  createdBy          IdAndRole?
  isActive           Boolean    @default(true)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  login              Login?
  address            Address?
  orders             Order[]
  dateOfBirth        DateTime?
}

type IdAndRole {
  userId String
  name   String?
  role   Role
}

type ShippingAndReturn {
  isFreeShipping Boolean @default(true)
}

enum ProductType {
  HARDWARE
  CURTAIN
  PILLOW
}

type Note {
  note      String
  createdBy IdAndRole
}

type ImageColorInfo {
  secondaryImagesPaths String[]
  colorInfo            Color?
  mainImagePath        String
}

model Address {
  id      String  @id @default(auto()) @map("_id") @db.ObjectId
  street1 String
  street2 String?
  city    String?
  zip     String?
  country String?
  userId  String  @unique @db.ObjectId
  user    User    @relation(fields: [userId], references: [id])
}

model Login {
  id                   String     @id @default(auto()) @map("_id") @db.ObjectId
  userId               String     @unique @db.ObjectId
  role                 Role
  userName             String?
  password             String
  communicationChannel String?
  lastLogin            DateTime[]
  user                 User?      @relation(fields: [userId], references: [id])
}

model Issue {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  status      Status   @default(OPEN)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Product {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Basic Info (for landing page + detail)
  name         String
  type         ProductType
  price        Int // Original/regular price
  salePrice    Int? // Discounted price (if on sale)
  isOutOfStock Boolean     @default(false)

  // Discount & Badges
  badges      Badge[] // Display badges (NEW, HOT, etc.)
  saleEndDate DateTime? // When sale ends (optional)

  // Images and Colors
  mainImagePath  String
  imageColorInfo ImageColorInfo[] // Each color has its own images

  // Detail Page Only
  detailDescription String
  careDescription   String
  rating            Float?
  code              String @unique
  inventory         Int

  isCustomizable Boolean @default(false)

  // Admin/Management
  createdBy      IdAndRole
  note           Note?
  isDetailFilled Boolean   @default(false)

  // Relations
  orderItems OrderItem[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  orderNumber String @unique // e.g., "ORD-2024-00001"

  // Customer Info
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  // Order Items
  items OrderItem[]

  // Pricing
  subtotal     Int // Sum of all items
  shippingCost Int @default(0)
  tax          Int @default(0)
  discount     Int @default(0)
  totalAmount  Int // Final amount paid

  // Shipping
  shippingAddress ShippingAddress?
  trackingNumber  String?
  isPickUp        Boolean?

  // Payment
  paymentMethod PaymentMethod
  paymentStatus PaymentStatus @default(PENDING)
  paidAt        DateTime?

  // Order Status
  orderStatus OrderStatus @default(PENDING)

  // Notes & History
  customerNote  String?
  adminNote     Note?
  statusHistory StatusChange[]

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cancelledAt DateTime?
  deliveredAt DateTime?
}

model OrderItem {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  orderId String @db.ObjectId
  order   Order  @relation(fields: [orderId], references: [id])

  productId String  @db.ObjectId
  product   Product @relation(fields: [productId], references: [id])

  // Snapshot at time of purchase (prices may change later)
  productName      String
  productCode      String
  productImagePath String
  selectedColor    Color?

  // Pricing at time of purchase
  unitPrice Int // Price per item when ordered
  quantity  Int
  subtotal  Int // unitPrice * quantity

  // Customization (if applicable)
  customization String?
}

type ShippingAddress {
  recipientName String
  phone         String
  street1       String
  street2       String?
  city          String
  zip           String
  country       String
}

type StatusChange {
  status    OrderStatus
  changedAt DateTime
  changedBy IdAndRole?
  note      String?
}

enum Status {
  OPEN
  IN_PROGRESS
  CLOSED
}

enum Badge {
  NEW
  HOT
  LIMITED
  BESTSELLER
  TRENDING
  SALE
}

// DEPRECATED: Old Deals enum - being phased out
// enum Deals {
//   BUY_1_GET_1
//   FIFTY_OFF
//   SEVENTY_OFF
//   TWENTY_OFF
//   FIFTEEN_OFF
//   TEN_OFF
//   NEW
// }

enum Color {
  RED
  BLUE
  GREEN
  YELLOW
  PINK
  PURPLE
  BLACK
  WHITE
  GREY
  NO_COLOR
}

enum Role {
  USER
  CUSTOMER
  ADMIN
  ROOT
}

enum OrderStatus {
  PENDING // Order placed, awaiting payment
  PAYMENT_CONFIRMED // Payment received
  PROCESSING // Being prepared
  SHIPPED // Out for delivery
  DELIVERED // Successfully delivered
  CANCELLED // Cancelled by customer/admin
  REFUNDED // Payment refunded
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  BANK_TRANSFER
  CASH_ON_DELIVERY
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}
